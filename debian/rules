#!/usr/bin/make -f

## Copyright (C) 2016 - 2020 ENCRYPTED SUPPORT LP <adrelanos@riseup.net>
## See the file COPYING for copying conditions.

#export DH_VERBOSE=1

## Cannot set. Causes tests to fail. Also not required since upstream already
## sets hardening options in upstream Makefile.
## https://github.com/GrapheneOS/hardened_malloc/issues/120#issuecomment-694933692
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#DPKG_EXPORT_BUILDFLAGS = 1
#include /usr/share/dpkg/buildflags.mk

## Intentionally dropping: -fstack-protector-strong -Wformat -Werror=format-security
## Unintentionally dropping: -fdebug-prefix-map=
CFLAGS =

CC  := clang

%:
	dh $@

override_dh_installchangelogs:
	dh_installchangelogs changelog.upstream upstream

override_dh_auto_build:
	dh_auto_build -- CONFIG_NATIVE=false CC=$(CC)

#dh_auto_test:
## Tests failing inside (cowbuilder) chroot.
## https://github.com/GrapheneOS/hardened_malloc/issues/119
## Not doing anything about it because test fails open, does not break the
## build.
